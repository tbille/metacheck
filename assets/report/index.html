<html>
  <head>

    </head>
  <body>
    <h1>Metacheck report <span id="siteName"></span>
    <div id="table"></div>
    <script>const data = {{data}};</script>
    <script>
      const siteNameEl = document.getElementById("siteName");
      siteNameEl.innerText = `for ${data.site}`;

      const headings = Object.keys(data.pages[0]);

      const tableEl = document.getElementById("table");
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const theadTr = document.createElement("tr");
      headings.forEach((heading) => {
        const th = document.createElement("th");
        th.style.borderBottom = "1px solid #000";
        th.innerText = heading;
        theadTr.appendChild(th);
      });
      thead.appendChild(theadTr);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      data.pages.forEach((row) => {
        const tr = document.createElement("tr");
        headings.forEach((heading) => {
          const td = document.createElement("td");
          td.style.borderBottom = "1px solid #999";
          if (heading === "metadata" && row[heading]) {
            td.innerText = Object.keys(row[heading]).map((key) => `${key}: ${row[heading][key]}`).join("\n");
          } else {
            td.innerText = row[heading];
          }
          tr.append(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(tbody);

      tableEl.appendChild(table);
    </script>
  </body>
  </html>
